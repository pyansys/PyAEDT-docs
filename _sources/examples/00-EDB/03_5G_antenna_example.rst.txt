
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "examples\00-EDB\03_5G_antenna_example.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_examples_00-EDB_03_5G_antenna_example.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_examples_00-EDB_03_5G_antenna_example.py:


EDB: 5G linear array antenna
----------------------------
This example shows how to use HFSS 3D Layout to create and solve a 5G linear array antenna.

.. GENERATED FROM PYTHON SOURCE LINES 6-15

.. code-block:: default



    import tempfile
    from pyaedt import Edb
    from pyaedt.generic.general_methods import generate_unique_name
    from pyaedt import Hfss3dLayout
    import os









.. GENERATED FROM PYTHON SOURCE LINES 16-19

Set non-graphical mode
~~~~~~~~~~~~~~~~~~~~~~
Set non-graphical mode. The default is ``False``.

.. GENERATED FROM PYTHON SOURCE LINES 19-79

.. code-block:: default



    non_graphical = os.getenv("PYAEDT_NON_GRAPHICAL", "False").lower() in ("true", "1", "t")



    class Patch:
        def __init__(self, width=0.0, height=0.0, position=0.0):
            self.width = width
            self.height = height
            self.position = position

        @property
        def points(self):
            return [
                [self.position, -self.height / 2],
                [self.position + self.width, -self.height / 2],
                [self.position + self.width, self.height / 2],
                [self.position, self.height / 2],
            ]


    class Line:
        def __init__(self, length=0.0, width=0.0, position=0.0):
            self.length = length
            self.width = width
            self.position = position

        @property
        def points(self):
            return [
                [self.position, -self.width / 2],
                [self.position + self.length, -self.width / 2],
                [self.position + self.length, self.width / 2],
                [self.position, self.width / 2],
            ]


    class LinearArray:
        def __init__(self, nb_patch=1, array_length=10e-3, array_width=5e-3):
            self.nbpatch = nb_patch
            self.length = array_length
            self.width = array_width

        @property
        def points(self):
            return [
                [-1e-3, -self.width / 2 - 1e-3],
                [self.length + 1e-3, -self.width / 2 - 1e-3],
                [self.length + 1e-3, self.width / 2 + 1e-3],
                [-1e-3, self.width / 2 + 1e-3],
            ]


    tmpfold = tempfile.gettempdir()
    aedb_path = os.path.join(tmpfold, generate_unique_name("pcb") + ".aedb")
    print(aedb_path)
    edb = Edb(edbpath=aedb_path, edbversion="2022.2")






.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    D:\Temp\pcb_UZYEDA.aedb
    pyaedt info: Logger started on D:\Temp\pyaedt20220722_091734.log
    pyaedt info: Logger is initialized in EDB.
    pyaedt info: Refreshing the Components dictionary.
    pyaedt info: Refreshing the Components dictionary.
    pyaedt info: Refreshing the Components dictionary.
    pyaedt info: Refreshing the Components dictionary.
    pyaedt info: Refreshing the Components dictionary.
    pyaedt info: Refreshing the Components dictionary.
    pyaedt info: Refreshing the Components dictionary.
    pyaedt info: Objects Initialized
    pyaedt info: EDB D:\Temp\pcb_UZYEDA.aedb was created correctly.
    pyaedt info: EDB was initialized.




.. GENERATED FROM PYTHON SOURCE LINES 80-84

Add stackup layers
~~~~~~~~~~~~~~~~~~
Add the stackup layers.


.. GENERATED FROM PYTHON SOURCE LINES 84-91

.. code-block:: default

    if edb:
        edb.core_stackup.stackup_layers.add_layer("Virt_GND")
        edb.core_stackup.stackup_layers.add_layer("Gap", "Virt_GND", layerType=1, thickness="0.05mm", material="Air")
        edb.core_stackup.stackup_layers.add_layer("GND", "Gap")
        edb.core_stackup.stackup_layers.add_layer("Substrat", "GND", layerType=1, thickness="0.5mm", material="Duroid (tm)")
        edb.core_stackup.stackup_layers.add_layer("TOP", "Substrat")








.. GENERATED FROM PYTHON SOURCE LINES 92-95

Create linear array
~~~~~~~~~~~~~~~~~~~
Create the first patch of the linear array.

.. GENERATED FROM PYTHON SOURCE LINES 95-104

.. code-block:: default


    first_patch = Patch(width=1.4e-3, height=1.2e-3, position=0.0)
    first_patch_poly = edb.core_primitives.Shape("polygon", points=first_patch.points)
    edb.core_primitives.create_polygon(first_patch_poly, "TOP", net_name="Array_antenna")
    # First line
    first_line = Line(length=2.4e-3, width=0.3e-3, position=first_patch.width)
    first_line_poly = edb.core_primitives.Shape("polygon", points=first_line.points)
    edb.core_primitives.create_polygon(first_line_poly, "TOP", net_name="Array_antenna")





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    pyaedt info: Primitives Updated

    <Ansys.Ansoft.Edb.Cell.Primitive.Polygon object at 0x000001828F0BE2C0>



.. GENERATED FROM PYTHON SOURCE LINES 105-108

Patch linear array
~~~~~~~~~~~~~~~~~~
Patch the linear array.

.. GENERATED FROM PYTHON SOURCE LINES 108-131

.. code-block:: default


    patch = Patch(width=2.29e-3, height=3.3e-3)
    line = Line(length=1.9e-3, width=0.2e-3)
    linear_array = LinearArray(nb_patch=8, array_width=patch.height)

    current_patch = 1
    current_position = first_line.position + first_line.length

    while current_patch <= linear_array.nbpatch:
        patch.position = current_position
        patch_shape = edb.core_primitives.Shape("polygon", points=patch.points)
        edb.core_primitives.create_polygon(patch_shape, "TOP", net_name="Array_antenna")
        current_position += patch.width
        if current_patch < linear_array.nbpatch:
            line.position = current_position
            line_shape = edb.core_primitives.Shape("polygon", points=line.points)
            edb.core_primitives.create_polygon(line_shape, "TOP", net_name="Array_antenna")
            current_position += line.length
        current_patch += 1

    linear_array.length = current_position









.. GENERATED FROM PYTHON SOURCE LINES 132-135

Add ground
~~~~~~~~~~
Add a ground.

.. GENERATED FROM PYTHON SOURCE LINES 135-140

.. code-block:: default


    gnd_shape = edb.core_primitives.Shape("polygon", points=linear_array.points)
    edb.core_primitives.create_polygon(gnd_shape, "GND", net_name="GND")






.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none


    <Ansys.Ansoft.Edb.Cell.Primitive.Polygon object at 0x000001828F07EEC0>



.. GENERATED FROM PYTHON SOURCE LINES 141-144

Add connector pin
~~~~~~~~~~~~~~~~~
Add a central connector pin.

.. GENERATED FROM PYTHON SOURCE LINES 144-156

.. code-block:: default


    edb.core_padstack.create_padstack(padstackname="Connector_pin", holediam="100um", paddiam="0", antipaddiam="200um")
    con_pin = edb.core_padstack.place_padstack(
        [first_patch.width / 4, 0],
        "Connector_pin",
        net_name="Array_antenna",
        fromlayer="TOP",
        tolayer="GND",
        via_name="coax",
    )






.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    pyaedt info: Padstack Connector_pin create correctly




.. GENERATED FROM PYTHON SOURCE LINES 157-160

Add connector ground
~~~~~~~~~~~~~~~~~~~~
Add a connector ground.

.. GENERATED FROM PYTHON SOURCE LINES 160-194

.. code-block:: default


    virt_gnd_shape = edb.core_primitives.Shape("polygon", points=first_patch.points)
    edb.core_primitives.create_polygon(virt_gnd_shape, "Virt_GND", net_name="GND")
    edb.core_padstack.create_padstack("gnd_via", "100um", "0", "0", "GND", "Virt_GND")
    con_ref1 = edb.core_padstack.place_padstack(
        [first_patch.points[0][0] + 0.2e-3, first_patch.points[0][1] + 0.2e-3],
        "gnd_via",
        fromlayer="GND",
        tolayer="Virt_GND",
        net_name="GND",
    )
    con_ref2 = edb.core_padstack.place_padstack(
        [first_patch.points[1][0] - 0.2e-3, first_patch.points[1][1] + 0.2e-3],
        "gnd_via",
        fromlayer="GND",
        tolayer="Virt_GND",
        net_name="GND",
    )
    con_ref3 = edb.core_padstack.place_padstack(
        [first_patch.points[2][0] - 0.2e-3, first_patch.points[2][1] - 0.2e-3],
        "gnd_via",
        fromlayer="GND",
        tolayer="Virt_GND",
        net_name="GND",
    )
    con_ref4 = edb.core_padstack.place_padstack(
        [first_patch.points[3][0] + 0.2e-3, first_patch.points[3][1] - 0.2e-3],
        "gnd_via",
        fromlayer="GND",
        tolayer="Virt_GND",
        net_name="GND",
    )






.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    pyaedt info: Padstack gnd_via create correctly




.. GENERATED FROM PYTHON SOURCE LINES 195-198

Add excitation port
~~~~~~~~~~~~~~~~~~~
Add an excitation port.

.. GENERATED FROM PYTHON SOURCE LINES 198-203

.. code-block:: default


    edb.core_padstack.set_solderball(con_pin, "Virt_GND", isTopPlaced=False, ballDiam=0.1e-3)
    port_name = edb.core_padstack.create_coax_port(con_pin)









.. GENERATED FROM PYTHON SOURCE LINES 204-207

Plot geometry
~~~~~~~~~~~~~
Plot the geometry.

.. GENERATED FROM PYTHON SOURCE LINES 207-210

.. code-block:: default


    edb.core_nets.plot(None)




.. image-sg:: /examples/00-EDB/images/sphx_glr_03_5G_antenna_example_001.png
   :alt: Cell_QRK99I
   :srcset: /examples/00-EDB/images/sphx_glr_03_5G_antenna_example_001.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    pyaedt info: Nets Point Generation time 0.0 seconds




.. GENERATED FROM PYTHON SOURCE LINES 211-214

Save EDB
~~~~~~~~
Save EDB.

.. GENERATED FROM PYTHON SOURCE LINES 214-220

.. code-block:: default


    if edb:
        edb.standalone = False
        edb.save_edb()
        edb.close_edb()
    print("EDB saved correctly to {}. You can import in AEDT.".format(aedb_path))




.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    pyaedt info: EDB file release time: 0.00ms
    EDB saved correctly to D:\Temp\pcb_UZYEDA.aedb. You can import in AEDT.




.. GENERATED FROM PYTHON SOURCE LINES 221-224

Launch HFSS 3D Layout and open EDB
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Launch HFSS 3D Layout and open EDB.

.. GENERATED FROM PYTHON SOURCE LINES 224-228

.. code-block:: default


    project = os.path.join(aedb_path, "edb.def")
    h3d = Hfss3dLayout(projectname=project, specified_version="2022.2", new_desktop_session=True, non_graphical=non_graphical)





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    pyaedt info: Logger Started
    pyaedt info: Launching PyAEDT outside AEDT with CPython and PythonNET.
    pyaedt info: AEDT installation Path C:\Program Files\AnsysEM\v222\Win64.
    pyaedt info: Launching AEDT with module PythonNET.
    pyaedt info: Ansoft.ElectronicsDesktop.2022.2 Started with process ID 6732.
    pyaedt info: Logger file D:\Temp\pyaedt20220722_091734.log in use.
    pyaedt info: pyaedt v0.5.9
    pyaedt info: Python version 3.8.10 (tags/v3.8.10:3d8993a, May  3 2021, 11:48:03) [MSC v.1928 64 bit (AMD64)]
    pyaedt info: EDB folder D:\Temp\pcb_UZYEDA.aedb\edb.def has been imported to project pcb_UZYEDA
    pyaedt info: Active Design set to Cell_QRK99I
    pyaedt info: Aedt Objects initialized
    pyaedt info: Variable Manager initialized
    pyaedt info: Design Loaded
    pyaedt info: Successfully loaded project materials !
    pyaedt info: Materials Loaded
    pyaedt info: aedt file load time 0.0
    pyaedt info: Analysis Loaded
    pyaedt info: Loading Modeler.
    pyaedt info: Modeler loaded.
    pyaedt info: EDB loaded.
    pyaedt info: Layers loaded.
    pyaedt info: Primitives loaded.
    pyaedt info: Modeler Loaded




.. GENERATED FROM PYTHON SOURCE LINES 229-232

Plot geometry
~~~~~~~~~~~~~~~~~
Plot the geometry. The EDB methods are also accessible from the ``Hfss3dlayout`` class.

.. GENERATED FROM PYTHON SOURCE LINES 232-235

.. code-block:: default


    h3d.modeler.edb.core_nets.plot(None)




.. image-sg:: /examples/00-EDB/images/sphx_glr_03_5G_antenna_example_002.png
   :alt: Cell_QRK99I
   :srcset: /examples/00-EDB/images/sphx_glr_03_5G_antenna_example_002.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    pyaedt info: Logger is initialized in EDB.
    pyaedt info: EDB Path D:/Temp/pcb_UZYEDA.aedb
    pyaedt info: EDB Version 2022.2
    pyaedt info: EDB Standalone True
    pyaedt info: Database Opened
    pyaedt info: Cell Cell_QRK99I Opened
    pyaedt info: C:\actions-runner\_work\PyAEDT\PyAEDT\pyaedt\dlls\EDBLib
    pyaedt info: Refreshing the Components dictionary.
    pyaedt info: Refreshing the Components dictionary.
    pyaedt info: Refreshing the Components dictionary.
    pyaedt info: Refreshing the Components dictionary.
    pyaedt info: Refreshing the Components dictionary.
    pyaedt info: Refreshing the Components dictionary.
    pyaedt info: Refreshing the Components dictionary.
    pyaedt info: Objects Initialized
    pyaedt info: Builder was initialized.
    pyaedt info: EDB was initialized.
    pyaedt info: Primitives Updated
    pyaedt info: Nets Point Generation time 0.078 seconds




.. GENERATED FROM PYTHON SOURCE LINES 236-245

Create setup and sweeps
~~~~~~~~~~~~~~~~~~~~~~~
Getters and setter facilitate the settings on the nested property dictionary.
Previously, you had to use these commands:

- `setup.props["AdaptiveSettings"]["SingleFrequencyDataList"]["AdaptiveFrequencyData"]["AdaptiveFrequency"] = "20GHz"`
- `setup.props["AdaptiveSettings"]["SingleFrequencyDataList"]["AdaptiveFrequencyData"]["MaxPasses"] = 4`

You can now use the simpler approach that follows.

.. GENERATED FROM PYTHON SOURCE LINES 245-265

.. code-block:: default


    setup = h3d.create_setup()

    setup["AdaptiveFrequency"] = "20GHz"
    setup["AdaptiveSettings/SingleFrequencyDataList/AdaptiveFrequencyData/MaxPasses"] = 4
    h3d.create_linear_count_sweep(
        setupname=setup.name,
        unit="GHz",
        freqstart=20,
        freqstop=50,
        num_of_freq_points=1001,
        sweepname="sweep1",
        sweep_type="Interpolating",
        interpolation_tol_percent=1,
        interpolation_max_solutions=255,
        save_fields=False,
        use_q3d_for_dc=False,
    )






.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    pyaedt info: Linear count sweep sweep1 has been correctly created.

    <pyaedt.modules.SetupTemplates.SweepHFSS3DLayout object at 0x00000182FD6F1460>



.. GENERATED FROM PYTHON SOURCE LINES 266-269

Solve setup and create results
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Solve the project and create report.

.. GENERATED FROM PYTHON SOURCE LINES 269-274

.. code-block:: default


    h3d.analyze_nominal()
    h3d.post.create_report(["db(S({0},{1}))".format(port_name, port_name)])






.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    pyaedt info: Solving design setup MySetupAuto
    pyaedt info: Design setup MySetupAuto solved correctly

    <pyaedt.modules.report_templates.Standard object at 0x000001828117BCD0>



.. GENERATED FROM PYTHON SOURCE LINES 275-278

Plot results outside AEDT
~~~~~~~~~~~~~~~~~~~~~~~~~
Plot results using Matplotlib.

.. GENERATED FROM PYTHON SOURCE LINES 278-282

.. code-block:: default


    solution = h3d.post.get_solution_data(["S({0},{1})".format(port_name, port_name)])
    solution.plot()




.. image-sg:: /examples/00-EDB/images/sphx_glr_03_5G_antenna_example_003.png
   :alt: Simulation Results Plot
   :srcset: /examples/00-EDB/images/sphx_glr_03_5G_antenna_example_003.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    pyaedt info: Solution Data Correctly Loaded.

    <Figure size 2000x1000 with 1 Axes>



.. GENERATED FROM PYTHON SOURCE LINES 283-288

Close AEDT
~~~~~~~~~~
After the simulaton completes, you can close AEDT or release it using the
:func:`pyaedt.Desktop.release_desktop` function.
All functions provide for saving the project before closing AEDT.

.. GENERATED FROM PYTHON SOURCE LINES 288-291

.. code-block:: default


    h3d.save_project()
    h3d.release_desktop()




.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    pyaedt info: Project pcb_UZYEDA Saved correctly

    True




.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 1 minutes  58.215 seconds)


.. _sphx_glr_download_examples_00-EDB_03_5G_antenna_example.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: 03_5G_antenna_example.py <03_5G_antenna_example.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: 03_5G_antenna_example.ipynb <03_5G_antenna_example.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
